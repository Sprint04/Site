<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" type="imagex/png" href="../assets/logo-icon.png">
    <link rel="stylesheet" href="../css/dashboards.css">
    <title>Trackware - Dashboards</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body onload="obterDadosGrafico()">
    <div class="container_pagina">
        <div class="menu_dashboard">
            <div class="container_logo_menu_dashboard">
                <div class="logo_menu_dashboard">
                    <img src="../assets/logo-icon.png" alt="logo_menu">
                </div>
            </div>
            <div class="opcoes_menu_dashboard">
                <button>Usuário</button>
                <button>Funcionários</button>
                <button>Planos</button>
                <button>Monitoramento</button>
                <button>Alertas</button>
                <button>Chamados</button>
                <button>Históricos</button>
            </div>
        </div>
        <div class="tela_dashboard">
            <div class="container_mensagem_botao">
                <div class="container_mensagem_usuario">
                    <div class="img_usuario">
                        <img src="../assets/user.png" alt="">
                    </div>
                    <div class="mensagem_usuario">
                        Olá, <span>Usuário!</span>
                    </div>
                </div>
                <div class="container_botao_maquinas">
                    <div class="botao_maquina">
                        <select name="" id="">
                            <option value="">Máquina 1</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="nome_empresa">
                <span>Empresa Cliente</span>
            </div>
            <div class="container_cards_monitoramento">
                <button class="card">
                    <div class="container_dados_botao">
                        <span class="tipo_componente">CPU</span>
                        <div class="dado_monitoramento">
                            <span class="dado">0%</span>
                            <span class="tipo_utilizacao">Utilizado</span>
                        </div>
                    </div>
                </button>
                <button class="card">
                    <div class="container_dados_botao">
                        <span class="tipo_componente">RAM</span>
                        <div class="dado_monitoramento">
                            <span class="dado">0%</span>
                            <span class="tipo_utilizacao">Utilizada</span>
                        </div>
                    </div>
                </button>
                <button class="card">
                    <div class="container_dados_botao">
                        <span class="tipo_componente">DISCO</span>
                        <div class="dado_monitoramento">
                            <span class="dado">0%</span>
                            <span class="tipo_utilizacao">Utilizado</span>
                        </div>
                    </div>
                </button>
                <button class="card">
                    <div class="container_dados_botao">
                        <span class="tipo_componente">REDE</span>
                        <div class="dado_monitoramento">
                            <span class="dado">0</span>
                            <span class="tipo_utilizacao">Bytes</span>
                        </div>
                    </div>
                </button>
            </div>
            <!-- gráfico abaixo !!! -->
            <div class="container_grafico">
                <canvas id="Grafico_Principal">
                </canvas>
            </div>
        </div>
    </div>
</body>

</html>

<!-- script características do Gráfico -->
<!-- <script>
    const labels = [
        'January',
        'February',
        'March',
        'April',
        'May',
        'June',
    ];

    const data = {
        labels: labels,
        datasets: [{
            label: 'CPU usage',
            backgroundColor: 'rgb(255, 99, 132)',
            borderColor: 'rgb(255, 99, 132)',
            data: [],
        }]
    };

    
</script> -->
<script>
    var ctx = document.getElementById('Grafico_Principal').getContext('2d');

    let label_teste = [];

    var data = {
        labels: ['Atualização a cada 5 minutos'],
        datasets: [{
            label: 'CPU',
            backgroundColor: 'green',
            borderColor: 'black',
            fill: false,
            data: [10],
            tension: 0.1
        },

        {
            label: 'RAM',
            backgroundColor: 'red',
            borderColor: 'black',
            fill: false,
            data: [75],
            tension: 0.1
        },

        {
            label: 'DISCO',
            backgroundColor: 'blue',
            borderColor: 'black',
            fill: false,
            data: [55],
            tension: 0.1
        }
        ]
    };

    var options = {
        responsive: true,
        plugins: {
            title: {
                display: true,
                text: 'Monitoração dos principais componentes (Em %)',
                font: {
                    size: 16,
                    color: '#ff5733' // Altere a cor aqui
                }
            }
        }
    };

    var Grafico_Principal = new Chart(ctx, {
        type: 'bar',
        data: data,
        options: options
    });
</script>
<!-- script config do Grafico, fetch & plot -->
<!-- <script>

    function obterDadosGrafico() {
        fetch(`/dashboard/obterDadosGrafico`, { cache: 'no-store' }).then(function (response) {
            if (response.ok) {
                response.json().then(function (resposta) {
                    console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
                    resposta.reverse();

                    plotarGrafico(resposta);
                });
            } else {
                console.error('Nenhum dado encontrado ou erro na API');
            }
        })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
            });
    }

    function plotarGrafico(resposta) {
        // Criando estrutura para plotar gráfico - labels
        let labels = [];
        // 
        // Criando estrutura para plotar gráfico - dados
        let data = {
            labels: labels,
            datasets: [{
                label: 'CPU usage',
                data: [],
                backgroundColor: ['rgb(0, 99, 140)', 'rgb(0, 99, 90)'],
                borderColor: '#fff',
                borderwidth: 1
            }]
        };
        const config = {
            type: 'line',
            data: data,
        };

        console.log('iniciando plotagem do gráfico...');
        const myChart = new Chart(
            document.getElementById('myChart'),
            config
        );



        // Inserindo valores recebidos em estrutura para plotar o gráfico
        for (i = 0; i < resposta.length; i++) {
            var registro = resposta[i];
            // labels.push(registro.Novo_Testamento);
            labels.push(registro.dtHora);
            data.datasets[0].data.push(registro.dadoCapturado); // dadoCapturado é o nome da coluna do mySQL
            // dados.datasets[0].data.push(registro.Novo_Testamento);
            // dados.datasets[1].data.push(registro.temperatura);
        }

        console.log('----------------------------------------------')
        console.log('Estes dados foram recebidos pela funcao "obterDadosGrafico" e passados para "plotarGrafico":')
        console.log(resposta)
    }
    // setInterval(plotarGrafico, 3000);
</script> -->